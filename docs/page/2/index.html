<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>🥳</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="🥳">
<meta property="og:url" content="https://solobit.cn/page/2/index.html">
<meta property="og:site_name" content="🥳">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="MangK">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="🥳" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">🥳</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://solobit.cn"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-Golang-GUI开发总结" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/11/03/Golang-GUI%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/" class="article-date">
  <time class="dt-published" datetime="2022-11-03T05:53:12.000Z" itemprop="datePublished">2022-11-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Golang/">Golang</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/11/03/Golang-GUI%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/">Golang GUI开发总结</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li><a target="_blank" rel="noopener" href="https://github.com/ying32/govcl">govcl</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/fyne-io/fyne">fyne</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/wailsapp/wails">wails</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/lxn/walk">walk</a></li>
<li><a target="_blank" rel="noopener" href="https://www.wxwidgets.org/">wxwidgets</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/webview/webview">webview</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://solobit.cn/2022/11/03/Golang-GUI%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/" data-id="clp2idasd0004x4fyd7ol10w6" data-title="Golang GUI开发总结" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GUI/" rel="tag">GUI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Golang构建桌面程序之webview" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/11/03/Golang%E6%9E%84%E5%BB%BA%E6%A1%8C%E9%9D%A2%E7%A8%8B%E5%BA%8F%E4%B9%8Bwebview/" class="article-date">
  <time class="dt-published" datetime="2022-11-03T04:19:36.000Z" itemprop="datePublished">2022-11-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Golang/">Golang</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/11/03/Golang%E6%9E%84%E5%BB%BA%E6%A1%8C%E9%9D%A2%E7%A8%8B%E5%BA%8F%E4%B9%8Bwebview/">Golang构建桌面程序之webview</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="序"><a href="#序" class="headerlink" title="序"></a>序</h2><p>最近接到的任务是开发一个可以在mac和windows上运行的程序，作为一个golang程序员首先想到的自然是golang。跨平台编译运行也让他可以做这件事。结合前面我了解到的一些框架（<a target="_blank" rel="noopener" href="https://github.com/ying32/govcl">govcl</a>,<a target="_blank" rel="noopener" href="https://github.com/fyne-io/fyne">fyne</a>,<a target="_blank" rel="noopener" href="https://github.com/wailsapp/wails">wails</a>,<a target="_blank" rel="noopener" href="https://github.com/lxn/walk">walk</a>,<a target="_blank" rel="noopener" href="https://www.wxwidgets.org/">wxwidgets</a>），考虑学习的时间成本我本来是想用<a target="_blank" rel="noopener" href="https://github.com/fyne-io/fyne">fyne</a>来做。直到后来我找到了这个能更快完成需求的包<a target="_blank" rel="noopener" href="https://github.com/webview/webview">webview</a>。所以今天主要来介绍<a target="_blank" rel="noopener" href="https://github.com/webview/webview">webview</a>这个可以跨平台生成可执行文件的框架。</p>
<h2 id="Golang-的-webview-package"><a href="#Golang-的-webview-package" class="headerlink" title="Golang 的 webview package"></a>Golang 的 webview package</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://solobit.cn/2022/11/03/Golang%E6%9E%84%E5%BB%BA%E6%A1%8C%E9%9D%A2%E7%A8%8B%E5%BA%8F%E4%B9%8Bwebview/" data-id="clp2idasf0008x4fy7pwb1ga1" data-title="Golang构建桌面程序之webview" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GUI/" rel="tag">GUI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/embed/" rel="tag">embed</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gin/" rel="tag">gin</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webview/" rel="tag">webview</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-docker-swarm集群的使用" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/09/30/docker-swarm%E9%9B%86%E7%BE%A4%E7%9A%84%E4%BD%BF%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2022-09-30T04:48:35.000Z" itemprop="datePublished">2022-09-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Docker/">Docker</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/09/30/docker-swarm%E9%9B%86%E7%BE%A4%E7%9A%84%E4%BD%BF%E7%94%A8/">Docker Swarm集群的使用</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="序"><a href="#序" class="headerlink" title="序"></a>序</h2><p>咱们书接<a href="/2022/09/27/%E4%BD%BF%E7%94%A8alpine%E6%9E%84%E5%BB%BAdocker%E9%95%9C%E5%83%8F/">上回</a>，我搞定了golang程序的编译，搞定了docker镜像的打包，搞定了流水线。现在项目部署与热更新成了我要面对的问题。<br>受制于公司提供的部署环境（只提供给我一台主机，主机上有docker），我暂时没有k8s集群可用，但又希望能完成基于流水线的自动部署、热更新和不停机更新。所以返现了下面要说的<code>docker swarm</code></p>
<h2 id="什么是-swarm-mode"><a href="#什么是-swarm-mode" class="headerlink" title="什么是 swarm mode"></a>什么是 swarm mode</h2><p>Swarm 是使用 SwarmKit 构建的 Docker 引擎内置（原生）的集群管理和编排工具。具体内容可以参见：<a target="_blank" rel="noopener" href="https://yeasy.gitbook.io/docker_practice/swarm_mode/overview">基本概念</a>，这里不再详细解释。</p>
<h2 id="集群创建"><a href="#集群创建" class="headerlink" title="集群创建"></a>集群创建</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker swarm init</span><br><span class="line">Swarm initialized: current node (dxn1zf6l61qsb1josjja83ngz) is now a manager.</span><br><span class="line"></span><br><span class="line">To add a worker to this swarm, run the following command:</span><br><span class="line"></span><br><span class="line">    docker swarm join \</span><br><span class="line">    --token SWMTKN-1-49nj1cmql0jkz5s954yi3oex3nedyz0fb0xx14ie39trti4wxv-8vxv8rssmk743ojnwacrr2e7c \</span><br><span class="line">    192.168.99.100:2377</span><br><span class="line"></span><br><span class="line">To add a manager to this swarm, run &#x27;docker swarm join-token manager&#x27; and follow the instructions.</span><br></pre></td></tr></table></figure>
<p>使用<code>docker swarm init</code>命令，创建一个集群，本机的docker就会变成一个单节点的集群。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://solobit.cn/2022/09/30/docker-swarm%E9%9B%86%E7%BE%A4%E7%9A%84%E4%BD%BF%E7%94%A8/" data-id="clp2idasg000ex4fy3i4m5gq0" data-title="Docker Swarm集群的使用" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-使用alpine构建docker镜像" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/09/27/%E4%BD%BF%E7%94%A8alpine%E6%9E%84%E5%BB%BAdocker%E9%95%9C%E5%83%8F/" class="article-date">
  <time class="dt-published" datetime="2022-09-27T03:21:51.000Z" itemprop="datePublished">2022-09-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Docker/">Docker</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/09/27/%E4%BD%BF%E7%94%A8alpine%E6%9E%84%E5%BB%BAdocker%E9%95%9C%E5%83%8F/">使用alpine构建Docker镜像</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="序"><a href="#序" class="headerlink" title="序"></a>序</h2><p>最近的工作中，我使用Golang开发了一个web项目，并准备通过流水线的方式做持续集成与发布。在这是用过程中遇到了一些技术与问题包括：<a href="#%E9%80%9A%E8%BF%87Makefile%E6%89%93%E5%8C%85Golang%E7%A8%8B%E5%BA%8F">通过make构建golang程序</a>、<a href="#Dockerfile%E4%B8%8D%E8%83%BD%E8%AE%BF%E9%97%AE%E7%88%B6%E7%BA%A7%E7%9B%AE%E5%BD%95">dockerfile不能访问父级目录</a>、<a href="#%E4%BD%BF%E7%94%A8Alpine%E4%BD%9C%E4%B8%BA%E5%9F%BA%E7%A1%80%E6%9D%A5%E5%88%B6%E4%BD%9C%E6%88%91%E7%9A%84%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F">使用Alpine作为基础来制作我的容器镜像</a></p>
<h1 id="通过Makefile打包Golang程序"><a href="#通过Makefile打包Golang程序" class="headerlink" title="通过Makefile打包Golang程序"></a>通过Makefile打包Golang程序</h1><h2 id="什么是Makefile"><a href="#什么是Makefile" class="headerlink" title="什么是Makefile"></a>什么是Makefile</h2><blockquote>
<p>代码变成可执行文件，叫做编译（compile）；先编译这个，还是先编译那个（即编译的安排），叫做构建（build）。Make是最常用的构建工具，诞生于1977年，主要用于C语言的项目。但是实际上，任何只要某个文件有变化，就要重新构建的项目，都可以用Make构建。</p>
<p>关于make命令这里不做深入介绍，引用链接提供介绍清晰明了的直通车（让我们感谢大神🙏）<br><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2015/02/make.html">阮一峰的网络日志-Make命令教程</a></p>
</blockquote>
<h2 id="Golang项目使用Makefile"><a href="#Golang项目使用Makefile" class="headerlink" title="Golang项目使用Makefile"></a>Golang项目使用Makefile</h2><p>我对makefile文件的理解是它有点像时一个命令的集合，通过一个个target&lt;目标&gt;可以按照顺序快速的执行多条命令而不用再手动一条条输入。if else与变量的加入让这个流程变得更加丰富和多变。省去了命令输入的同时也让代码运行的流程更加清楚。</p>
<h3 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: build clean run</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># golang 打包可执行文件的运行环境 (可以在运行make命令时传入：make OS=windows)</span></span><br><span class="line">OS=linux</span><br><span class="line">BUILD_DOCKER_IMAGE=0</span><br><span class="line"></span><br><span class="line"><span class="section">all: build</span></span><br><span class="line"></span><br><span class="line"><span class="section">run:</span></span><br><span class="line">    go run ./cmd/main.go</span><br><span class="line"></span><br><span class="line"><span class="section">build:</span></span><br><span class="line">    <span class="comment"># 下面的GOOS=$(OS)使用了上面定义的OS变量</span></span><br><span class="line">    @GO111MODULE=on GOPROXY=https://goproxy.cn,direct CGO_ENABLED=0 go mod tidy &amp;&amp; GOOS=<span class="variable">$(OS)</span> go build -o app main.go</span><br><span class="line"><span class="comment"># if判断中同样可以使用变量</span></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(BUILD_DOCKER_IMAGE)</span>,1)</span><br><span class="line">    @cd deploy &amp;&amp; docker build -t .</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">    <span class="comment"># 命令前加@会让命令执行但不在控制台输出，这里没有@命令执行时会输出到终端</span></span><br><span class="line">    rm app</span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(BUILD_DOCKER_IMAGE)</span>,1)</span><br><span class="line">    @docker rmi recommend_photo</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<h1 id="Dockerfile不能访问父级目录"><a href="#Dockerfile不能访问父级目录" class="headerlink" title="Dockerfile不能访问父级目录"></a>Dockerfile不能访问父级目录</h1><p>项目汇中我使用Dockerfile作为构架docker镜像的基础。通过<code>docker build -t image_name .</code>可以将内容打包成本地的docker镜像。但是鉴于我现有的项目目录结构使得<code>COPY</code>无法找到对应的文件，在查阅<code>docker build</code>命令后，发现可以通过<code>-f</code>选项来执行相关目录。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">我的目录结构</span><br><span class="line">.</span><br><span class="line">├── README.md</span><br><span class="line">├── cmd</span><br><span class="line">│   └── main.go</span><br><span class="line">├── conf</span><br><span class="line">│   ├── ...</span><br><span class="line">├── deploy</span><br><span class="line">│   └── Dockerfile</span><br><span class="line">├── http</span><br><span class="line">│   ├── ...</span><br><span class="line">├── model</span><br><span class="line">│   ├── ...</span><br><span class="line">├── makefile</span><br><span class="line">├── go.mod</span><br><span class="line">├── go.sum</span><br><span class="line">├── config.yaml</span><br><span class="line">├── sample.config.yaml</span><br></pre></td></tr></table></figure>
<h2 id="解决Dockerbuild目录可见性问题（使用-f-选项）"><a href="#解决Dockerbuild目录可见性问题（使用-f-选项）" class="headerlink" title="解决Dockerbuild目录可见性问题（使用 -f 选项）"></a>解决Dockerbuild目录可见性问题（使用 -f 选项）</h2><p>docker与dockerfile的关系这里不再阐述。这只单独介绍docker build<code>-f</code>选项的使用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">➜  project git:(dev) docker build -h   </span><br><span class="line">Flag shorthand -h has been deprecated, please use --help</span><br><span class="line"></span><br><span class="line">Usage:  docker build [OPTIONS] PATH | URL | -</span><br><span class="line"></span><br><span class="line">Build an image from a Dockerfile</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --add-host list           Add a custom host-to-IP mapping (host:ip)</span><br><span class="line">      --build-arg list          Set build-time variables</span><br><span class="line">      --cache-from strings      Images to consider as cache sources</span><br><span class="line">      --disable-content-trust   Skip image verification (default true)</span><br><span class="line">  -f, --file string             Name of the Dockerfile (Default is &#x27;PATH/Dockerfile&#x27;)</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>
<p>平时使用docker build一般是在根目录存在Dockerfile，构建的时候Dockerfile会在当前目录寻找需要的文件，但是在我的目录结构中，Dockerfile被放到了deploy目录下，导致我在根目录执行docker build会找不到file，但是cd到deploy目录里又会导致Dockerfile找不到根目录的文件。所以这里<code>-f</code>选项就可以使用了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t name:tag  -f deploy/Dockerfile ./deploy</span><br></pre></td></tr></table></figure>
<p><code>-f</code>选项指定了Dockerfile所在的目录，最后的<code>./deploy</code>是docker构建使用的根目录</p>
<h2 id="向Dockerfile中传递编译参数"><a href="#向Dockerfile中传递编译参数" class="headerlink" title="向Dockerfile中传递编译参数"></a>向Dockerfile中传递编译参数</h2><p>通过<code>-build-arg &#123;ARG_NAME&#125;=&#123;value&#125;</code>可以传递参数，那么在dockerfile中，通过<code>arg</code> 定义的变量可以接收到传递到参数<code>ARG ARG_NAME=hello</code></p>
<h1 id="使用Alpine作为基础来制作我的容器镜像"><a href="#使用Alpine作为基础来制作我的容器镜像" class="headerlink" title="使用Alpine作为基础来制作我的容器镜像"></a>使用Alpine作为基础来制作我的容器镜像</h1><h2 id="Docker打包出的镜像超过1G让我不能接受"><a href="#Docker打包出的镜像超过1G让我不能接受" class="headerlink" title="Docker打包出的镜像超过1G让我不能接受"></a>Docker打包出的镜像超过1G让我不能接受</h2><p>在项目刚写完的时候，我使用golang官网的docker镜像作为基础来构建我自己的镜像。这样做可以不用担心环境问题，打包golang构建docker一气呵成固然方便，但当我看到我的镜像有1.2G大的时候猛打了一个寒颤～这是在超出我的所料。<br>作为追求精简的程序员，这种情况不允许发生在我的项目里，于是便有了下面的内容</p>
<h2 id="Alpine镜像是什么"><a href="#Alpine镜像是什么" class="headerlink" title="Alpine镜像是什么"></a>Alpine镜像是什么</h2><blockquote>
<p>Alpine 操作系统是一个面向安全的轻型 Linux 发行版。它不同于通常 Linux 发行版，Alpine 采用了 musl libc(注意这里，是个坑) 和 busybox 以减小系统的体积和运行时资源消耗，但功能上比 busybox 又完善的多，因此得到开源社区越来越多的青睐。在保持瘦身的同时，Alpine 还提供了自己的包管理工具 apk，可以通过 <a target="_blank" rel="noopener" href="https://pkgs.alpinelinux.org/packages">https://pkgs.alpinelinux.org/packages</a> 网站上查询包信息，也可以直接通过 apk 命令直接查询和安装各种软件。</p>
</blockquote>
<h2 id="将golang编译与docker打包拆分"><a href="#将golang编译与docker打包拆分" class="headerlink" title="将golang编译与docker打包拆分"></a>将golang编译与docker打包拆分</h2><p>为了尽可能的减小docker镜像的体积，我采用了只将golang可执行文件与config文件打包进镜像的方案（大家可以制作自己的打包服务器或者直接使用各种CI&#x2F;CD流水线来帮助构建镜像）。在这之后，我的小而美的docker镜像中只存在两个必要文件<code>app(可执行文件) &amp; config.yaml</code>。而我的镜像也变成了精简的49MB</p>
<h2 id="制作镜像时遇到的问题"><a href="#制作镜像时遇到的问题" class="headerlink" title="制作镜像时遇到的问题"></a>制作镜像时遇到的问题</h2><p>可是当我使用镜像构建容器的时候，却总是提示</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  project git:(dev) docker run -it --rm 351b4d544b4e</span><br><span class="line">exec /app/app: no such file or directory</span><br></pre></td></tr></table></figure>
<p>开始很没头绪，因为使用了阿里云的流水线服务所以我还特意发了工单去询问（这显得我很白痴）。后来我通过<code>docker save imageID &gt; filename.tar</code>的方式将镜像下载到本地，然后解压去查找对应的文件，发现<code>/app/app</code>可执行文件就好好的躺在它该在的目录。这时候我才把目光转向了我的基础镜像。于是发现并解决了如下问题(部分内容引用自<a target="_blank" rel="noopener" href="https://mozillazg.com/2020/03/use-alpine-image-common-issues.rst.html">使用Alpine作为基础镜像时可能会遇到的常见问题的解决方法</a>)：</p>
<h2 id="镜像中存在可执行文件但是报错no-such-file-or-directory"><a href="#镜像中存在可执行文件但是报错no-such-file-or-directory" class="headerlink" title="镜像中存在可执行文件但是报错no such file or directory"></a>镜像中存在可执行文件但是报错no such file or directory</h2><p>由于golang构建与docker基于alpine打包分开<br>我的二进制文件是使用动态链接方式编译了一个使用了GLIBC库的程序生成的，但是alpne镜像中没有GLIBC库而是用的MUSL LIBC库，这样就会导致该二进制文件无法被执行。<br>解决方案一般有两种：</p>
<blockquote>
<ul>
<li>改为静态编译</li>
<li>如果要使用动态链接函数编译的话，不要依赖GLIBC（比如编译Go程序的时候指定CGO_ENABLED&#x3D;0 ）或者在alpine中编译一个依赖MUSL LIBC的版本</li>
</ul>
</blockquote>
<p>追求精简的我选择了第一种<a target="_blank" rel="noopener" href="https://juejin.cn/post/7053450610386468894">静态编译</a><br>同时也实测简单的指定<code>CGO_ENABLED=0</code>并不完全解决问题</p>
<h2 id="alpine时区问题"><a href="#alpine时区问题" class="headerlink" title="alpine时区问题"></a>alpine时区问题</h2><p>有些使用 alpine 作为基础镜像的 go 程序镜像可能会出现类似下面这样的错误:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">panic: open /usr/local/go/lib/time/zoneinfo.zip: no such file or directory</span><br><span class="line"></span><br><span class="line">Init mysql error: unknown time zone Asia/Shanghai</span><br></pre></td></tr></table></figure>
<p>常见原因：alpine 基础镜像中没有包含时区信息文件，当代码中有调用类似下面这样的通过名称获取时区信息的时候，就会出现上面的错误。<br>所以需要我们在构建镜像是安装自己需要的时区文件,之后就不会存在时区问题了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">FROM alpine:latest</span><br><span class="line"></span><br><span class="line">WORKDIR /app</span><br><span class="line"></span><br><span class="line">ENV TZ Asia/Shanghai</span><br><span class="line">RUN apk update &amp;&amp; apk add tzdata</span><br><span class="line">RUN cp /usr/share/zoneinfo/$&#123;TZ&#125; /etc/localtime \</span><br><span class="line">    &amp;&amp; echo $&#123;TZ&#125; &gt; /etc/timezone</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>以上，解决了我这次项目中的问题。</p>
<p>本来还想写一下关于golang静态编译的问题，但发现我还没有真正搞明白，所以先贴个链接吧，以后再写：<a target="_blank" rel="noopener" href="https://juejin.cn/post/7053450610386468894">https://juejin.cn/post/7053450610386468894</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://solobit.cn/2022/09/27/%E4%BD%BF%E7%94%A8alpine%E6%9E%84%E5%BB%BAdocker%E9%95%9C%E5%83%8F/" data-id="clp2idash000ix4fybh167wzl" data-title="使用alpine构建Docker镜像" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Coding/">Coding</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Golang/">Golang</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Reading/">Reading</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F/">小程序</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/GUI/" rel="tag">GUI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gateway/" rel="tag">Gateway</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MifareClassic/" rel="tag">MifareClassic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NFC/" rel="tag">NFC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ndef/" rel="tag">Ndef</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Server/" rel="tag">Server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Why-Always-Wechat/" rel="tag">Why Always Wechat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/embed/" rel="tag">embed</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gin/" rel="tag">gin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webview/" rel="tag">webview</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/GUI/" style="font-size: 16.67px;">GUI</a> <a href="/tags/Gateway/" style="font-size: 10px;">Gateway</a> <a href="/tags/Golang/" style="font-size: 20px;">Golang</a> <a href="/tags/MifareClassic/" style="font-size: 13.33px;">MifareClassic</a> <a href="/tags/NFC/" style="font-size: 13.33px;">NFC</a> <a href="/tags/Ndef/" style="font-size: 13.33px;">Ndef</a> <a href="/tags/Server/" style="font-size: 13.33px;">Server</a> <a href="/tags/Why-Always-Wechat/" style="font-size: 10px;">Why Always Wechat</a> <a href="/tags/embed/" style="font-size: 16.67px;">embed</a> <a href="/tags/gin/" style="font-size: 13.33px;">gin</a> <a href="/tags/vue/" style="font-size: 13.33px;">vue</a> <a href="/tags/webview/" style="font-size: 13.33px;">webview</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">十一月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">三月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">十一月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">九月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/1970/01/">一月 1970</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/11/02/%E5%B0%8F%E7%A8%8B%E5%BA%8Fwx-navigateTo%E4%B8%AD%E7%9A%84%E9%97%AD%E5%8C%85/">小程序wx.navigateTo中的闭包</a>
          </li>
        
          <li>
            <a href="/2023/03/09/%E5%85%8D%E8%B4%B9%E6%B3%9B%E5%9F%9F%E5%90%8DSSL%E8%AF%81%E4%B9%A6/">免费泛域名SSL证书</a>
          </li>
        
          <li>
            <a href="/2022/11/18/NFC%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B8%8E%E8%AF%BB%E5%86%99/">NFC基础知识与读写</a>
          </li>
        
          <li>
            <a href="/2022/11/03/Golang-embed%E5%8C%85%E7%9A%84%E4%BD%BF%E7%94%A8/">Golang-Embed包的使用</a>
          </li>
        
          <li>
            <a href="/2022/11/03/Golang-GUI%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/">Golang GUI开发总结</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 MangK<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>